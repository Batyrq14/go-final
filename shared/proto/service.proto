syntax = "proto3";

package proto;

option go_package = "github.com/Batyrq14/go-final/shared/proto";

service UserService {
  rpc Register(RegisterRequest) returns (AuthResponse);
  rpc Login(LoginRequest) returns (AuthResponse);
  rpc ValidateToken(ValidateTokenRequest) returns (UserResponse);
  rpc GetUser(GetUserRequest) returns (UserResponse);
  rpc ListProviders(ListProvidersRequest) returns (ListProvidersResponse);
}

message ListProvidersRequest {
  int32 limit = 1;
  int32 offset = 2;
}

message ListProvidersResponse {
  repeated ProviderResponse providers = 1;
}

message ProviderResponse {
  UserResponse user = 1;
  string location = 2;
  double hourly_rate = 3;
  int32 experience_years = 4;
  string bio = 5;
  bool is_available = 6;
  double rating = 7;
  string provider_id = 8;
}

message RegisterRequest {
  string email = 1;
  string password = 2;
  string full_name = 3;
  string role = 4;
  string phone = 5;
}

message LoginRequest {
  string email = 1;
  string password = 2;
}

message ValidateTokenRequest {
  string token = 1;
}

message GetUserRequest {
  string user_id = 1;
}

message AuthResponse {
  string token = 1;
  UserResponse user = 2;
}

message UserResponse {
  string id = 1;
  string email = 2;
  string full_name = 3;
  string role = 4;
  string phone = 5;
}

service MarketplaceService {
  rpc CreateService(CreateServiceRequest) returns (ServiceResponse);
  rpc GetServices(GetServicesRequest) returns (GetServicesResponse);
  rpc CreateBooking(CreateBookingRequest) returns (BookingResponse);
  rpc ListBookings(ListBookingsRequest) returns (ListBookingsResponse);
  rpc UpdateBookingStatus(UpdateBookingStatusRequest) returns (BookingResponse);
}

message CreateServiceRequest {
  string user_id = 1;
  string title = 2;
  string description = 3;
  double price = 4;
  string category = 5;
}

message ServiceResponse {
  string id = 1;
  string title = 2;
  string description = 3;
  double price = 4;
  string provider_id = 5;
}

message GetServicesRequest {
  string category = 1;
}

message GetServicesResponse {
  repeated ServiceResponse services = 1;
}

message CreateBookingRequest {
  string service_id = 1;
  string user_id = 2; // Client ID
  string provider_id = 3;
  string scheduled_time = 4; // ISO string
}

message BookingResponse {
  string id = 1;
  string status = 2;
}

service ChatService {
  rpc GetHistory(GetHistoryRequest) returns (GetHistoryResponse);
  rpc SendMessage(SendMessageRequest) returns (SendMessageResponse);
}

message GetHistoryRequest {
  string user_id_1 = 1;
  string user_id_2 = 2;
  int32 limit = 3;
  int32 offset = 4;
}

message Message {
  string id = 1;
  string sender_id = 2;
  string receiver_id = 3;
  string content = 4;
  string timestamp = 5;
}

message GetHistoryResponse {
  repeated Message messages = 1;
}

message SendMessageRequest {
    string sender_id = 1;
    string receiver_id = 2;
    string content = 3;
}

message SendMessageResponse {
    string id = 1;
    string timestamp = 2;
}

message ListBookingsRequest {
  string user_id = 1;
  string role = 2; // "client" or "provider"
}

message BookingDetails {
  string id = 1;
  string service_id = 2;
  string client_id = 3;
  string provider_id = 4;
  string status = 5;
  string scheduled_time = 6;
  string service_title = 7;
  string other_party_name = 8; // Client Name (for provider) or Provider Name (for client)
}

message ListBookingsResponse {
  repeated BookingDetails bookings = 1;
}

message UpdateBookingStatusRequest {
  string booking_id = 1;
  string status = 2; 
  string user_id = 3;
}

